"use strict";function onjQueryLoaded(){ftui.init(),$(".menu").on("click",function(){$(".menu").toggleClass("show")}),$(window).on("beforeunload",function(){ftui.log(5,"beforeunload"),ftui.setOffline()}),$(window).on("online offline",function(){ftui.log(5,"online offline"),navigator.onLine?ftui.setOnline():ftui.setOffline()}),window.onerror=function(t,e,i,n,a){var r=e.split("/").pop();return ftui.toast([r+":"+i,a].join("<br/>"),"error"),!1},$.fn.once=function(t,e){return this.each(function(){$(this).off(t).on(t,e)})},$.fn.widgetId=function(){return["ftui",$(this).data("type"),$(this).data("device"),$(this).data("get")].join("_")},$.fn.filterData=function(t,e){return this.filter(function(){return $(this).data(t)==e})},$.fn.filterDeviceReading=function(t,e,i){return this.filter(function(){var n=$(this),a=n.data(t);return String(a)===i&&String(n.data("device"))===e||a===e+":"+i||$.inArray(i,a)>-1&&String(n.data("device"))===e||$.inArray(e+":"+i,a)>-1})},$.fn.isValidData=function(t){return"undefined"!=typeof $(this).data(t)},$.fn.initData=function(t,e){var i=$(this);return i.data(t,i.isValidData(t)?i.data(t):e),i},$.fn.mappedColor=function(t){return ftui.getStyle("."+$(this).data(t),"color")||$(this).data(t)},$.fn.matchingState=function(t,e){if(!ftui.isValid(e))return"";var i=String(ftui.getPart(e,$(this).data(t+"-part"))),n=$(this).data(t+"-on"),a=$(this).data(t+"-off"),r=String(n),o=String(a);if(ftui.isValid(n)){if(i===r)return"on";if(i.match(new RegExp("^"+r+"$")))return"on"}if(ftui.isValid(a)){if(i===o)return"off";if(i.match(new RegExp("^"+o+"$")))return"off"}if(ftui.isValid(n)&&ftui.isValid(a)){if("!off"===r&&i!==o)return"on";if("!on"===o&&i!==r)return"off"}},$.fn.isDeviceReading=function(t){var e=$(this).data(t);return e&&!$.isNumeric(e)&&e.match(/:/)},$.fn.isExternData=function(t){var e=$(this).data(t);return e?e.match(/^[#\.\[].*/):""},$.fn.getReading=function(t,e){var i=String($(this).data("device")),n=$(this).data(t);if($.isArray(n)&&(n=n[e]),n=String(n),n&&n.match(/:/)){var a=n.split(":");i=a[0],n=a[1]}if(i&&i.length>0){var r=ftui.deviceStates[i];return r&&r[n]?r[n]:{}}return{}},$.fn.valOfData=function(t){var e=$(this).data(t);return ftui.isValid(e)?e.toString().match(/^[#\.\[].*/)?$(e).data("value"):e:""},$.fn.transmitCommand=function(){if(!$(this).hasClass("notransmit")){var t=[$(this).valOfData("cmd"),$(this).valOfData("device"),$(this).valOfData("set"),$(this).valOfData("value")].join(" ");ftui.setFhemStatus(t),ftui.toast(t)}}}if("function"==typeof Framework7){var f7={ftui:new Framework7({animateNavBackIcon:!0}),options:{dynamicNavbar:!0,domCache:!0},views:[]};$(".view").each(function(t){var e=f7.ftui.addView("#"+$(this)[0].id,{dynamicNavbar:!0});f7.ftui.views.push(e)}),f7.ftui.onPageInit("*",function(t){ftui.log(t.name+" initialized"),ftui.initWidgets('[data-page="'+t.name+'"]')})}var Modul_widget=function(){function update_lock(t,e){me.elements.filterDeviceReading("lock",t,e).each(function(t){var e=$(this),i=e.getReading("lock").val;"on"===e.matchingState("lock",i)&&e.addClass("lock"),"off"===e.matchingState("lock",i)&&e.removeClass("lock")})}function update_hide(t,e){me.elements.filterDeviceReading("hide",t,e).each(function(t){var e=$(this),i=e.getReading("hide").val;"on"===e.matchingState("hide",i)&&(ftui.isValid(e.data("hideparents"))?e.parents(e.data("hideparents")).hide():e.hide()),"off"===e.matchingState("hide",i)&&(ftui.isValid(e.data("hideparents"))?e.parents(e.data("hideparents")).show():e.show())})}function update_reachable(t,e){me.elements.filterDeviceReading("reachable",t,e).each(function(t){var e=$(this),i=e.getReading("reachable").val;"on"===e.matchingState("reachable",i)&&e.removeClass("unreachable"),"off"===e.matchingState("reachable",i)&&e.addClass("unreachable")})}function substitution(value,subst){if(ftui.isValid(subst))if($.isArray(subst))for(var i=0,len=subst.length;len>i;i+=2){var match=value.match(new RegExp(subst[i]));if(match&&len>i+1)return console.log(value,"match",subst[i],subst[i+1]),subst[i+1].replace("$1",value)}else{if(subst.match(/^s/)){var f=subst.substr(1,1),sub=subst.split(f);return value.replace(new RegExp(sub[1],sub[3]),sub[2])}if(subst.match(/weekdayshort/))return ftui.dateFromString(value).ee();if(subst.match(/.*\(\)/))return eval("value."+subst)}return value}function fix(t,e){return $.isNumeric(t)&&e>=0?Number(t).toFixed(e):t}function map(t,e,i){if("object"==typeof t&&null!==t)for(var n in t)if(e===n||e.match(new RegExp("^"+n+"$")))return t[n];return i}function init_attr(t){}function init_ui(t){t.text(me.widgetname)}function init(){ftui.log(1,"init widget: name="+me.widgetname+" area="+me.area),me.elements=$('[data-type="'+me.widgetname+'"]',me.area),me.elements.each(function(t){me.init_attr($(this)),me.init_ui($(this))})}function addReading(t,e){var i=t.data(e);if(ftui.isValid(i)&&($.isArray(i)||!i.toString().match(/^[#\.\[].*/))){var n=t.data("device");$.isArray(i)||(i=new Array(i.toString()));for(var a=0,r=i.length;r>a;a++){var o=i[a];if(o.match(/:/)){var s=o.split(":");n=s[0],o=s[1]}if(ftui.isValid(n)&&ftui.isValid(o)){n=n.toString();var l="STATE"===o?n:[n,o].join("-");subscriptions[l]={},subscriptions[l].device=n,subscriptions[l].reading=o}}}}function update(t,e){ftui.log(1,"warning: "+me.widgetname+" has not implemented update function")}var subscriptions={},elements,me={widgetname:"widget",area:"",init:init,init_attr:init_attr,init_ui:init_ui,update:update,update_lock:update_lock,update_reachable:update_reachable,update_hide:update_hide,substitution:substitution,fix:fix,map:map,addReading:addReading,subscriptions:subscriptions,elements:elements};return me},plugins={modules:[],addModule:function(t){this.modules.push(t)},removeArea:function(t){for(var e=this.modules.length-1;e>=0;e-=1)this.modules[e].area===t&&this.modules.splice(e,1)},updateParameters:function(){ftui.subscriptions={},ftui.subscriptionTs={},ftui.devs=[ftui.config.webDevice];for(var t=this.modules.length-1;t>=0;t-=1){var e=this.modules[t];for(var i in e.subscriptions){ftui.subscriptions[i]=e.subscriptions[i],ftui.subscriptionTs[i+"-ts"]=e.subscriptions[i];var n=ftui.subscriptions[i].device;ftui.devs.indexOf(n)<0&&ftui.devs.push(n)}}ftui.states.lastShortpoll=0},load:function(t,e){return ftui.log(1,"Load widget : "+t),ftui.loadPlugin(t,e)},update:function(t,e){$.each(this.modules,function(i,n){"object"==typeof n&&n.update(t,e)}),ftui.updateBindElements("ftui.deviceStates"),ftui.log(1,'update done for "'+t+":"+e+'"')}},ftui={version:"2.6.6",config:{DEBUG:!1,DEMO:!1,dir:"",filename:"",basedir:"",fhemDir:"",debuglevel:0,doLongPoll:!0,lang:"de",shortpollInterval:0,styleCollection:{},stdColors:["green","orange","red","ligthblue","blue","gray","white","mint"]},poll:{currLine:0,xhr:null,longPollRequest:null,shortPollTimer:null,longPollTimer:null,lastUpdateTimestamp:new Date(1970,1,1),lastEventTimestamp:new Date(1970,1,1),lastShortpollTimestamp:new Date(1970,1,1)},states:{width:0,lastSetOnline:0,lastShortpoll:0,longPollRestart:!1},deviceStates:{},paramIdMap:{},timestampMap:{},subscriptions:{},subscriptionTs:{},gridster:{instances:{},instance:null,baseX:0,baseY:0,margins:5,mincols:0,cols:0,rows:0},init:function(){function n(){$.toast&&!$('link[href$="lib/jquery.toast.min.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/jquery.toast.min.css" type="text/css" />')}ftui.paramIdMap={},ftui.timestampMap={},ftui.devs=[ftui.config.webDevice],ftui.config.longPollType=$("meta[name='longpoll_type']").attr("content")||"websocket";var t=$("meta[name='longpoll']").attr("content")||"1";ftui.config.doLongPoll="0"!=t,ftui.config.longPollFilter=$("meta[name='longpoll_filter']").attr("content")||".*",ftui.config.DEMO="1"==$("meta[name='demo']").attr("content"),ftui.config.debuglevel=$("meta[name='debug']").attr("content")||0,ftui.config.webDevice=$("meta[name='web_device']").attr("content")||"WEB",ftui.config.maxLongpollAge=$("meta[name='longpoll_maxage']").attr("content")||240,ftui.config.DEBUG=ftui.config.debuglevel>0,ftui.config.TOAST=$("meta[name='toast']").attr("content")||5,ftui.config.shortpollInterval=$("meta[name='shortpoll_only_interval']").attr("content")||30;var e=window.location.pathname;ftui.config.filename=e.substring(e.lastIndexOf("/")+1),ftui.log(1,"Filename: "+ftui.config.filename),ftui.config.fhemDir=$("meta[name='fhemweb_url']").attr("content")||location.origin+"/fhem/",ftui.config.fhemDir=ftui.config.fhemDir.replace("///","//"),ftui.log(1,"FHEM dir: "+ftui.config.fhemDir);var i=navigator.language||navigator.userLanguage;ftui.config.lang=$("meta[name='lang']").attr("content")||ftui.isValid(i)?i.split("-")[0]:"de",ftui.getCSrf(),$.fn.toast?n():ftui.dynamicload(ftui.config.basedir+"lib/jquery.toast.min.js",!1).done(function(){n()}),$(document).on("visibilitychange",function(){"hidden"===document.visibilityState||(ftui.log(1,"Page became visible again -> start healthCheck in 3 secondes "),setTimeout(function(){ftui.healthCheck()},3e3))});try{localStorage.setItem("ftui",ftui.version),localStorage.removeItem("ftui")}catch(a){ftui.toast("You are in Privacy Mode<br>Please deactivate Privacy Mode and then reload the page.","error")}$("<div id='shade' />").prependTo("body").hide();var r=ftui.getAndroidVersion(),o=r&&parseFloat(r)<5,s=o?"touchstart":"touchstart mousedown";if($("#shade").on(s,function(t){$(document).trigger("shadeClicked")}),ftui.readStatesLocal(),0===$('link[href$="css/fhem-tablet-ui.css"]').length&&0===$('link[href$="css/fhem-tablet-ui.min.css"]').length){var l=ftui.config.basedir+"css/fhem-tablet-ui.css";$.when($.get(l,function(){$("<link>",{rel:"stylesheet",type:"text/css",href:l}).prependTo("head")})).then(function(){var t=0,e=setInterval(function(){ftui.log(1,"fhem-tablet-ui.css dynamically loaded. Waiting until it is ready to use..."),"center"===$("body").css("text-align")&&(ftui.log(1,"fhem-tablet-ui.css is ready to use."),clearInterval(e),ftui.loadStyleSchema(),ftui.initPage()),t++,t>120&&(clearInterval(e),ftui.toast("fhem-tablet-ui.css not ready to use","error"))},50)})}else ftui.loadStyleSchema(),ftui.initPage();$(document).on("initWidgetsDone",function(){ftui.startShortPollInterval(500),ftui.initHeaderLinks(),ftui.disableSelection()}),$(document).one("updateDone",function(){ftui.log(2,"document triggered updateDone"),ftui.updateBindElements(),ftui.initLongpoll()}),f7||$("*:not(select):not(textarea)").focus(function(){$(this).blur()}),setInterval(function(){ftui.healthCheck()},6e4)},initGridster:function(t){function e(){var e=-1,i=-1,n=0,a=0,r=0,o=0;$(".gridster > ul > li").each(function(){var t=$(this).data("col")+$(this).data("sizex")-1;t>e&&(e=t);var n=$(this).data("row")+$(this).data("sizey")-1;n>i&&(i=n)}),r=ftui.gridster.cols>0?ftui.gridster.cols:e,o=ftui.gridster.rows>0?ftui.gridster.rows:i;var s=2*r*ftui.gridster.margins,l=2*o*ftui.gridster.margins;n=ftui.gridster.baseX>0?ftui.gridster.baseX:(window.innerWidth-s)/r,a=ftui.gridster.baseY>0?ftui.gridster.baseY:(window.innerHeight-l)/o,ftui.gridster.mincols=parseInt($("meta[name='widget_min_cols']").attr("content")||r),ftui.gridster.instances[t]&&ftui.gridster.instances[t].destroy(),ftui.gridster.instances[t]=$(".gridster > ul",t).gridster({widget_base_dimensions:[n,a],widget_margins:[ftui.gridster.margins,ftui.gridster.margins],draggable:{handle:".gridster li > header"},min_cols:parseInt(ftui.gridster.mincols)}).data("gridster"),ftui.gridster.instances[t]&&("1"==$("meta[name='gridster_disable']").attr("content")&&ftui.gridster.instances[t].disable(),"1"==$("meta[name='gridster_starthidden']").attr("content")&&$(".gridster").hide());var f=$(".gridster > ul > li:has(* .gridster)");f.length>0&&f.css({"background-color":"transparent",margin:"-"+ftui.gridster.margins+"px",width:f.parent().width()-f.position().left,height:"100%"}),$(".gridster > ul > li:has(.center)").addClass("vbox"),$(".gridster > ul > li:has(.vbox)").addClass("vbox"),$(".gridster li > header ~ .hbox:only-of-type").each(function(t){$(this).css({height:"calc(100% - "+$(this).siblings("header").outerHeight()+"px)"})})}ftui.gridster.baseX=parseInt($("meta[name='widget_base_width'],meta[name='gridster_base_width']").attr("content")||0),ftui.gridster.baseY=parseInt($("meta[name='widget_base_height'],meta[name='gridster_base_height']").attr("content")||0),ftui.gridster.cols=parseInt($("meta[name='gridster_cols']").attr("content")||0),ftui.gridster.rows=parseInt($("meta[name='gridster_rows']").attr("content")||0),ftui.gridster.resize=parseInt($("meta[name='gridster_resize']").attr("content")||ftui.gridster.baseX+ftui.gridster.baseY>0?0:1),$("meta[name='widget_margin']").attr("content")&&(ftui.gridster.margins=parseInt($("meta[name='widget_margin']").attr("content"))),$(".gridster").length>0&&($('link[href$="lib/jquery.gridster.min.css"]').length||$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/jquery.gridster.min.css" type="text/css" />'),$.fn.gridster?e():ftui.dynamicload(ftui.config.basedir+"lib/jquery.gridster.min.js",!1).done(function(){e()}),ftui.gridster.resize&&$(window).on("resize",function(){ftui.states.width!==window.innerWidth&&(clearTimeout(ftui.states.delayResize),ftui.states.delayResize=setTimeout(e,500),ftui.states.width=window.innerWidth)}))},initPage:function(t){t=ftui.isValid(t)?t:"",console.time("initPage"),ftui.log(2,"initPage - area="+t),ftui.initGridster(t);var e=$.map($("[data-template]",t),function(t,e){var i=$(t);return $.get(i.data("template"),{},function(t){var e=i.data("parameter");for(var n in e)t=t.replace(new RegExp(n,"g"),e[n]);i.html(t)})});$.when.apply(this,e).then(function(){ftui.initWidgets(t),ftui.log(1,"init templates - Done")})},initWidgets:function(t){t=ftui.isValid(t)?t:"";var e=[];ftui.log(3,plugins),plugins.removeArea(t),ftui.log(3,plugins),ftui.log(2,"initWidgets - area="+t),$("[data-type]",t).each(function(t){var i=$(this).data("type");e.indexOf(i)<0&&e.push(i)});var i=$.map(e,function(e,i){return plugins.load(e,t)});$.when.apply(this,i).then(function(){plugins.updateParameters(),ftui.log(1,"initWidgets - Done"),console.timeEnd("initPage"),$(document).trigger("initWidgetsDone",[t])})},initHeaderLinks:function(){($("[class*=fa-]").length>0||$('[data-type="select"]').length>0||$('[data-type="homestatus"]').length>0)&&!$('link[href$="lib/font-awesome.min.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/font-awesome.min.css" type="text/css" />'),$("[class*=oa-]").length>0&&!$('link[href$="lib/openautomation.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/openautomation.css" type="text/css" />'),$("[class*=fs-]").length>0&&!$('link[href$="lib/fhemSVG.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/fhemSVG.css" type="text/css" />'),$("[class*=mi-]").length>0&&!$('link[href$="lib/material-icons.min.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/material-icons.min.css" type="text/css" />'),$("[class*=wi-]").length>0&&!$('link[href$="lib/weather-icons.min.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/weather-icons.min.css" type="text/css" />'),$("[class*=wi-wind]").length>0&&!$('link[href$="lib/weather-icons-wind.min.css"]').length&&$("head").append('<link rel="stylesheet" href="'+ftui.config.basedir+'lib/weather-icons-wind.min.css" type="text/css" />')},initLongpoll:function(){if(ftui.log(2,"initLongpoll: "+ftui.config.doLongPoll),ftui.config.doLongPoll){var t=$("meta[name='longpoll_delay']").attr("content");t=$.isNumeric(t)?1e3*t:100,ftui.startLongPollInterval(t)}},startShortPollInterval:function(t){ftui.log(1,"start shortpoll in (ms):"+(t||1e3*ftui.config.shortpollInterval)),clearInterval(ftui.shortPollTimer),ftui.shortPollTimer=setTimeout(function(){ftui.shortPoll(),ftui.startShortPollInterval()},t||1e3*ftui.config.shortpollInterval)},startLongPollInterval:function(t){ftui.config.DEBUG&&t>999&&ftui.toast("Start Longpoll in "+t/1e3+"s"),clearInterval(ftui.longPollTimer),ftui.longPollTimer=setTimeout(function(){ftui.longPoll()},t),ftui.config.shortpollInterval=$("meta[name='shortpoll_interval']").attr("content")||900},shortPoll:function(){var t=(new Date).getTime()/1e3;if(!(t-ftui.states.lastShortpoll<ftui.config.shortpollInterval)){ftui.log(1,"start shortpoll");var e=new Date;for(var i in ftui.devs){var n=ftui.deviceStates[i];for(var a in n)n[a].valid=!1}console.time("get jsonlist2");var r=ftui.devs.length>0?$.map(ftui.devs,$.trim).join():".*";ftui.log(4,"shortpoll: devicelist="+r),$.ajax({cache:!1,url:ftui.config.fhemDir,dataType:"json",data:{cmd:"jsonlist2 "+r,fwcsrf:ftui.config.csrf,XHR:"1"}}).done(function(i){function n(t,e){for(var i in e){var n=!1,a="STATE"===i?t:[t,i].join("-"),r=e[i];if("object"!=typeof r&&(r={Value:r,Time:""}),ftui.subscriptions[a]){var o=ftui.getDeviceParameter(t,i);n=!o||o.val!==r.Value||o.date!==r.Time}var s=ftui.deviceStates[t]||{},l=s[i]||{};l.date=r.Time,l.val=r.Value,l.valid=!0,s[i]=l,ftui.deviceStates[t]=s,ftui.paramIdMap[a]={},ftui.paramIdMap[a].device=t,ftui.paramIdMap[a].reading=i,ftui.timestampMap[a+"-ts"]={},ftui.timestampMap[a+"-ts"].device=t,ftui.timestampMap[a+"-ts"].reading=i,n&&(ftui.log(5,"[shortPoll] do update for "+t+","+i),plugins.update(t,i))}}if(console.timeEnd("get jsonlist2"),console.time("read jsonlist2"),ftui.log(3,"fhemJSON: 0="+Object.keys(i)[0]+" 1="+Object.keys(i)[1]),i&&i.Results){var a=i.Results.length;ftui.log(2,"shortpoll: fhemJSON.Results.length="+a);for(var r=i.Results,o=0;a>o;o++){var s=r[o],l=s.Name;l.indexOf("FHEMWEB")<0&&l.indexOf("WEB_")<0&&(n(l,s.Readings),n(l,s.Internals),n(l,s.Attributes))}var f=ftui.diffSeconds(e,new Date);if(ftui.config.DEBUG){var u=Object.keys(ftui.paramIdMap).length;ftui.toast("Full refresh done in "+f+"s for "+u+" parameter(s)")}ftui.log(1,"shortPoll - Done"),ftui.states.lastShortpoll=t,ftui.poll.lastShortpollTimestamp=new Date,ftui.saveStatesLocal(),ftui.updateBindElements("ftui."),ftui.onUpdateDone()}else ftui.log(1,"shortPoll request failed: Result is null"),ftui.toast("<u>ShortPoll Request Failed: : Result is null </u><br>","error");console.timeEnd("read jsonlist2")}).fail(function(t,e,i){var n=e+", "+i;ftui.log(1,"shortPoll request failed: "+n),ftui.states.lastSetOnline=0,ftui.states.lastShortpoll=0,e.indexOf("parsererror")<0?(ftui.toast("<u>ShortPoll Request Failed, will retry in 3s</u><br>"+n,"error"),ftui.startShortPollInterval(3e3)):ftui.toast("<u>ShortPoll Request Failed</u><br>"+n,"error")})}},longPoll:function(){if(ftui.config.DEMO)return void console.log("DEMO-Mode: no longpoll");if("WebSocket"in window&&"websocket"===ftui.config.longPollType&&ftui.deviceStates[ftui.config.webDevice]&&ftui.deviceStates[ftui.config.webDevice].longpoll&&ftui.deviceStates[ftui.config.webDevice].longpoll.val&&"websocket"===ftui.deviceStates[ftui.config.webDevice].longpoll.val){if(ftui.websocket)return void ftui.log(3,"valid ftui.websocket found");ftui.config.DEBUG&&ftui.toast("Longpoll (WebSocket) started");var t=ftui.config.fhemDir.replace(/^http/i,"ws")+"?XHR=1&inform=type=status;filter="+ftui.config.longPollFilter+";fmt=JSON&fwcsrf="+ftui.config.csrf;ftui.log(1,"websockets URL="+t),ftui.websocket=new WebSocket(t),ftui.websocket.onclose=function(t){ftui.log(1,"Error while longpoll: "+t),ftui.restartLongPoll()},ftui.websocket.onerror=function(t){ftui.log(1,"Error while longpoll: "+t),ftui.config.debuglevel>1&&ftui.toast("Error while longpoll (websocket)<br>"+t.data,"error"),ftui.restartLongPoll()},ftui.websocket.onmessage=function(t){ftui.handleUpdates(t.data)}}else{if(ftui.log(1,"longpoll: websockets not supportetd or not activated > fall back to AJAX"),ftui.xhr)return void ftui.log(3,"valid ftui.xhr found");if(ftui.longPollRequest)return void ftui.log(3,"valid ftui.longPollRequest found");ftui.poll.currLine=0,ftui.config.DEBUG&&(ftui.states.longPollRestart?ftui.toast("Longpoll (AJAX) re-started"):ftui.toast("Longpoll (AJAX) started")),ftui.log(1,ftui.states.longPollRestart?"Longpoll re-started":"Longpoll started"),ftui.states.longPollRestart=!1,ftui.longPollRequest=$.ajax({url:ftui.config.fhemDir,cache:!1,async:!0,method:"GET",data:{XHR:1,inform:"type=status;filter="+ftui.config.longPollFilter+";fmt=JSON",fwcsrf:ftui.config.csrf},xhr:function(){return ftui.xhr=new window.XMLHttpRequest,ftui.xhr.addEventListener("readystatechange",function(t){var e=t.target.responseText;4!==t.target.readyState&&3===t.target.readyState&&ftui.handleUpdates(e)},!1),ftui.xhr}}).done(function(t){ftui.xhr&&(ftui.xhr.abort(),ftui.xhr=null),ftui.longPollRequest=null,ftui.states.longPollRestart?ftui.longPoll():(ftui.log(1,"Disconnected from FHEM - poll done - "+t),ftui.restartLongPoll())}).fail(function(t,e,i){ftui.xhr&&(ftui.xhr.abort(),ftui.xhr=null),ftui.longPollRequest=null,ftui.states.longPollRestart?ftui.longPoll():(ftui.log(1,"Error while longpoll: "+e+": "+i),ftui.config.debuglevel>1&&ftui.toast("Error while longpoll (ajax)<br>"+e+": "+i,"error"),ftui.restartLongPoll())})}},handleUpdates:function(t){for(var e=t.split(/\n/),i=ftui.poll.currLine,n=e.length;n>i;i++){ftui.log(5,e[i]);var a=e[i].slice(-1);if(ftui.isValid(e[i])&&""!==e[i]&&"]"===a)try{var r=JSON.parse(e[i]),o=null,s=null,l=r[1]!==r[2];ftui.log(4,r);var f=ftui.paramIdMap[r[0]],u=ftui.timestampMap[r[0]];f&&(l&&(f.reading="STATE"),o=ftui.deviceStates[f.device]||{},s=o[f.reading]||{},s.val=r[1],s.valid=!0,o[f.reading]=s,ftui.deviceStates[f.device]=o,l&&ftui.subscriptions[r[0]]&&(ftui.poll.lastDevice=f.device,ftui.poll.lastReading=f.reading,ftui.poll.lastValue=s.val,plugins.update(f.device,f.reading))),u&&!l&&(o=ftui.deviceStates[u.device]||{},s=o[u.reading]||{},s.date=r[1],o[u.reading]=s,ftui.poll.lastUpdateTimestamp=s.date.toDate(),ftui.deviceStates[u.device]=o,ftui.subscriptionTs[r[0]]&&(ftui.poll.lastDevice=u.device,ftui.poll.lastReading=u.reading,ftui.poll.lastValue=s.val,plugins.update(u.device,u.reading)))}catch(c){ftui.log(1,"Error: (longpoll) "+c),ftui.log(1,"Bad line : "+e[i])}}ftui.poll.lastEventTimestamp=new Date,ftui.updateBindElements("ftui.poll"),ftui.websocket||(ftui.poll.currLine=e.length-1,ftui.poll.currLine>9999&&(ftui.states.longPollRestart=!0,ftui.longPollRequest.abort()))},setFhemStatus:function(t){return ftui.config.DEMO?void console.log("DEMO-Mode: no setFhemStatus"):(ftui.startShortPollInterval(),t=t.replace("  "," "),ftui.log(1,"send to FHEM: "+t),void $.ajax({async:!0,cache:!1,method:"POST",url:ftui.config.fhemDir,data:{cmd:t,fwcsrf:ftui.config.csrf,XHR:"1"}}).fail(function(t,e,i){ftui.toast("<u>FHEM Command Failed</u><br>"+e+": "+i,"error")}))},loadStyleSchema:function(){$.each($('link[href$="-ui.css"],link[href$="-ui.min.css"]'),function(t,e){if(e&&e.sheet&&e.sheet.cssRules){var i=e.sheet.cssRules;for(var n in i)if(i[n].style){var a=i[n].style.cssText.split(";");a.pop();var r=i[n].selectorText,o={};for(var s in a){var l=a[s].toString().split(":");l[0].match(/color/)&&(o[$.trim(l[0])]=ftui.rgbToHex($.trim(l[1]).replace("! important","").replace("!important","")))}Object.keys(o).length>0&&(ftui.config.styleCollection[r]=o)}}})},onUpdateDone:function(){$(document).trigger("updateDone"),ftui.checkInvalidElements()},checkInvalidElements:function(){$(".autohide[data-get]").each(function(t){var e=$(this),i=e.getReading("get").valid;i&&i===!0?e.removeClass("invalid"):e.addClass("invalid")})},updateBindElements:function(filter){$('[data-bind*="'+filter+'"]').each(function(index){var elem=$(this),variable=elem.data("bind");variable&&elem.text(eval(variable))})},setOnline:function(){var t=(new Date).getTime()/1e3;t-ftui.states.lastSetOnline>60&&(ftui.config.DEBUG&&ftui.toast("FHEM connected"),ftui.states.lastSetOnline=t,ftui.states.lastShortpoll=0,ftui.startShortPollInterval(1e3),ftui.config.doLongPoll||(ftui.config.doLongPoll="ajax"===ftui.config.longPollType||"websocket"===ftui.config.longPollType,ftui.config.doLongPoll&&ftui.startLongPollInterval(100)),ftui.log(1,"FTUI is online"))},setOffline:function(){ftui.config.DEBUG&&ftui.toast("Lost connection to FHEM"),ftui.config.doLongPoll=!1,clearInterval(ftui.shortPollTimer),clearInterval(ftui.longPollTimer),ftui.longPollRequest&&ftui.longPollRequest.abort(),ftui.websocket&&ftui.websocket.close(),ftui.saveStatesLocal(),ftui.log(1,"FTUI is offline")},readStatesLocal:function(){ftui.config.DEMO?$.ajax({async:!1,method:"GET",url:"/fhem/tablet/data/"+ftui.config.filename.replace(".html",".dat")}).done(function(t){ftui.deviceStates=JSON.parse(t)||{}}):ftui.deviceStates=JSON.parse(localStorage.getItem("deviceStates"))||{}},saveStatesLocal:function(){var t=JSON.stringify(ftui.deviceStates);localStorage.setItem("deviceStates",t),localStorage.setItem("shortPollDuration",ftui.poll.shortPollDuration)},restartLongPoll:function(){ftui.toast("Disconnected from FHEM"),ftui.websocket&&(ftui.websocket.close(),ftui.websocket=null),ftui.config.doLongPoll&&(ftui.toast("Retry to connect in 10 seconds"),setTimeout(function(){ftui.longPoll()},1e4))},getDeviceParameter:function(t,e){if(t&&t.length>0){var i=ftui.deviceStates[t];return i&&i[e]?i[e]:null}return null},loadPlugin:function(t,e){var i=new $.Deferred;return ftui.log(2,"Create widget : "+t),ftui.dynamicload(ftui.config.basedir+"js/widget_"+t+".js",!0).done(function(){var n=[],a=window["depends_"+t];if($.isFunction(a)){var r=a();r&&(r=$.isArray(r)?r:[r],$.map(r,function(t,e){t.indexOf(".js")<0?n.push(ftui.loadPlugin(t)):n.push(ftui.dynamicload(t,!1))}))}else ftui.log(2,"function depends_"+t+" not found (maybe ok)");$.when.apply(this,n).always(function(){var n=window["Modul_"+t]?new window["Modul_"+t]:null;if(n){if("undefined"!=typeof e){plugins.addModule(n),ftui.isValid(e)&&(n.area=e),ftui.log(1,"Try to init plugin: "+t),n.init();for(var a in n.subscriptions)n.update(n.subscriptions[a].device,n.subscriptions[a].reading)}ftui.log(1,"Loaded plugin: "+t)}else ftui.log(1,"Failed to create widget: "+t);i.resolve()})}).fail(function(){ftui.toast("Failed to load plugin : "+t),ftui.log(1,"Failed to load plugin : "+t+'  - add <script src="js/widget_'+t+'.js" defer></script> do your page, to see more informations about this failure'),i.resolve()}),i.promise()},dynamicload:function(t,e){ftui.config.DEBUG?!1:!0;ftui.log(3,"dynamic load file:"+t+" / async:"+e);var n=new $.Deferred,a=document.createElement("script");return a.type="text/javascript",a.async=e?!0:!1,a.src=t,a.onload=function(){ftui.log(3,"dynamic load done:"+t),n.resolve()},document.getElementsByTagName("head")[0].appendChild(a),n.promise()},getCSrf:function(){$.ajax({url:ftui.config.fhemDir,type:"GET",success:function(t,e,i){ftui.config.csrf=i.getResponseHeader("X-FHEM-csrfToken")}})},healthCheck:function(){if(ftui.config.debuglevel>0){var t=new Date;t.setTime(1e3*ftui.states.lastShortpoll),console.log("--------- start healthCheck --------------"),console.log("now:",new Date),console.log("FTUI version: "+ftui.version),console.log("Longpoll: "+ftui.config.doLongPoll),console.log("Longpoll type: "+ftui.config.longPollType),console.log("Longpoll objects there: "+(ftui.isValid(ftui.longPollRequest)&&ftui.isValid(ftui.xhr)||ftui.isValid(ftui.websocket))),console.log("Longpoll curent line: "+ftui.poll.currLine),console.log("Longpoll last event before: "+ftui.poll.lastEventTimestamp.ago()),console.log("Longpoll last reading uodate before: "+ftui.poll.lastUpdateTimestamp.ago()),console.log("Shortpoll interval: "+ftui.config.shortpollInterval),console.log("Shortpoll last run before: "+t.ago()),console.log("FHEM dev/par count: "+Object.keys(ftui.paramIdMap).length),console.log("FTUI known devices count: "+Object.keys(ftui.deviceStates).length),console.log("Page length: "+$("html").html().length),console.log("Widgets count: "+$("[data-type]").length),console.log("--------- end healthCheck ---------------")}var e=new Date-ftui.poll.lastEventTimestamp;e/1e3>ftui.config.maxLongpollAge&&ftui.config.maxLongpollAge>0&&!ftui.config.DEMO&&ftui.config.doLongPoll&&(ftui.log(1,"No longpoll event since "+e/1e3+"secondes -> restart polling"),ftui.setOnline(),ftui.restartLongPoll())},FS20:{dimmerArray:[0,6,12,18,25,31,37,43,50,56,62,68,75,81,87,93,100],dimmerValue:function(t){var e=ftui.indexOfNumeric(this.dimmerArray,t);return e>-1?this.dimmerArray[e]:0}},rgbToHsl:function(t){var e=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e/=255,i/=255,n/=255;var o,s,a=Math.max(e,i,n),r=Math.min(e,i,n),l=(a+r)/2;if(a==r)o=s=0;else{var f=a-r;switch(s=l>.5?f/(2-a-r):f/(a+r),a){case e:o=(i-n)/f+(n>i?6:0);break;case i:o=(n-e)/f+2;break;case n:o=(e-i)/f+4}o/=6}return[o,s,l]},hslToRgb:function(t,e,i){var n,a,r,s,o=function(t){return("0"+parseInt(t).toString(16)).slice(-2)};if(0===e)n=a=r=i;else{s=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t};var l=.5>i?i*(1+e):i+e-i*e,f=2*i-l;n=s(f,l,t+1/3),a=s(f,l,t),r=s(f,l,t-1/3)}return[o(Math.round(255*n)),o(Math.round(255*a)),o(Math.round(255*r))].join("")},rgbToHex:function(t){var e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t},getGradientColor:function(t,e,i){t=this.rgbToHex(t).replace(/^\s*#|\s*$/g,""),e=this.rgbToHex(e).replace(/^\s*#|\s*$/g,""),3==t.length&&(t=t.replace(/(.)/g,"$1$1")),3==e.length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(t.substr(0,2),16),a=parseInt(t.substr(2,2),16),r=parseInt(t.substr(4,2),16),o=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),l=parseInt(e.substr(4,2),16),f=o-n,u=s-a,c=l-r;return f=(f*i+n).toString(16).split(".")[0],u=(u*i+a).toString(16).split(".")[0],c=(c*i+r).toString(16).split(".")[0],1==f.length&&(f="0"+f),1==u.length&&(u="0"+u),1==c.length&&(c="0"+c),"#"+f+u+c},getPart:function(t,e){if(ftui.isValid(e)){if($.isNumeric(e)){var i=ftui.isValid(t)?t.toString().split(" "):"";return i.length>=e&&e>0?i[e-1]:t}var n="";if(ftui.isValid(t)){var a=t.match(new RegExp("^"+e+"$"));if(a)for(var r=1,o=a.length;o>r;r++)n+=a[r]}return n}return t},showModal:function(t){t?$("#shade").fadeIn():$("#shade").fadeOut()},precision:function(t){var e=t+"",i=e.indexOf(".")+1;return i?e.length-i:0},indexOfGeneric:function(t,e){if(!t)return-1;for(var i=0,n=t.length;n>i;i++)if(!$.isNumeric(t[i]))return ftui.indexOfRegex(t,e);return ftui.indexOfNumeric(t,e)},indexOfNumeric:function(t,e){for(var i=-1,n=0,a=t.length;a>n;n++)Number(e)>=Number(t[n])&&(i=n);return i},indexOfRegex:function(t,e){for(var i=0,n=t.length;n>i;i++)try{var a=e.match(new RegExp("^"+t[i]+"$"));if(a)return i}catch(r){}return t.indexOf(e)},isValid:function(t){return"undefined"!=typeof t&&void 0!==t&&typeof t!=typeof notusedvar},dateFromString:function(t){var e=t.match(/(\d+)-(\d+)-(\d+)[_\s](\d+):(\d+):(\d+).*/),i=t.match(/(\d\d).(\d\d).(\d\d\d\d)/),n=(new Date).getTimezoneOffset();return e?new Date(+e[1],+e[2]-1,+e[3],+e[4],+e[5],+e[6]):i?new Date(+i[3],+i[2]-1,+i[1],0,-n,0,0):new Date},diffMinutes:function(t,e){var i=new Date(e-t);return(i/1e3/60).toFixed(0)},diffSeconds:function(t,e){var i=new Date(e-t);return(i/1e3).toFixed(1)},durationFromSeconds:function(t){var e=Math.floor(t/3600),i=Math.floor(t%3600/60),n=t%60,a="";return e>0&&(a+=""+e+":"+(10>i?"0":"")),a+=""+i+":"+(10>n?"0":""),a+=""+n},mapColor:function(t){return ftui.getStyle("."+t,"color")||t},parseJsonFromString:function(t){return JSON.parse(t)},getAndroidVersion:function(t){t=(t||navigator.userAgent).toLowerCase();var e=t.match(/android\s([0-9\.]*)/);return e?e[1]:!1},getStyle:function(t,e){var i=ftui.config.styleCollection[t],n=i&&i[e]?i[e]:null;if(null===n){var a="."+t.split(".").reverse().join(".");a=a.substring(0,a.length-1),i=ftui.config.styleCollection[a],n=i&&i[e]?i[e]:null}return n},getClassColor:function(t){for(var e=0,i=ftui.config.stdColors.length;i>e;e++)if(t.hasClass(ftui.config.stdColors[e]))return ftui.getStyle("."+ftui.config.stdColors[e],"color");return null},getIconId:function(t){if(!t||""===t||!$('link[href$="lib/font-awesome.min.css"]').length)return"?";
var e=$('link[href$="lib/font-awesome.min.css"]')[0];if(e&&e.sheet&&e.sheet.cssRules){var i=e.sheet.cssRules;for(var n in i)if(i[n].selectorText&&i[n].selectorText.match(new RegExp(t+":"))){var a=i[n].style.content;return a?(a=a.replace(/"/g,"").replace(/'/g,""),/[^\u0000-\u00ff]/.test(a)?a:String.fromCharCode(parseInt(a.replace("\\",""),16))):t}}},disableSelection:function(){$("body").each(function(){this.onselectstart=function(){return!1},this.unselectable="on",$(this).css("-moz-user-select","none"),$(this).css("-webkit-user-select","none")})},toast:function(t,e){if(0!==ftui.config.TOAST){var i=ftui.config.TOAST;1==ftui.config.TOAST&&(i=!1),e&&"error"===e?f7?f7.ftui.addNotification({title:"FTUI",message:t,hold:1500}):$.toast&&$.toast({heading:"Error",text:t,hideAfter:2e4,icon:"error",loader:!1,stack:i}):f7?f7.ftui.addNotification({title:"FTUI",message:t,hold:1500}):$.toast&&$.toast({text:t,loader:!1,stack:i})}},log:function(t,e){ftui.config.debuglevel>=t&&console.log(e)}};String.prototype.toDate=function(){return ftui.dateFromString(this)},String.prototype.parseJson=function(){return ftui.parseJsonFromString(this)},String.prototype.toMinFromSec=function(){var t=Number(this),e=Math.floor(t%60).toString(),i=Math.floor(t/=60).toString();return i+":"+(e[1]?e:"0"+e[0])},String.prototype.toHoursFromSec=function(){var t=Number(this),e=Math.floor(t/3600).toString(),i=Math.floor(t%60).toString(),n=(Math.floor(t/60)-60*e).toString();return e+":"+(n[1]?n:"0"+n[0])+":"+(i[1]?i:"0"+i[0])},Date.prototype.addMinutes=function(t){return new Date(this.getTime()+6e4*t)},Date.prototype.ago=function(t){var e=new Date,i=e-this,n=i/1e3,a=Math.floor(n%60);n/=60;var r=Math.floor(n%60);n/=60;var o=Math.floor(n%24);n/=24;var f,s=Math.floor(n),l="de"===ftui.config.lang?["Tag(e)","Stunde(n)","Minute(n)","Sekunde(n)"]:["day(s)","hour(s)","minute(s)","second(s)"];return ftui.isValid(t)?(f=t.replace("dd",s),f=f.replace("hh",o>9?o:"0"+o),f=f.replace("mm",r>9?r:"0"+r),f=f.replace("ss",a>9?a:"0"+a),f=f.replace("h",o),f=f.replace("m",r),f=f.replace("s",a)):(f=s>0?s+" "+l[0]+" ":"",f+=o>0?o+" "+l[1]+" ":"",f+=r>0?r+" "+l[2]+" ":"",f+=a+" "+l[3]),f},Date.prototype.yyyymmdd=function(){var t=this.getFullYear().toString(),e=(this.getMonth()+1).toString(),i=this.getDate().toString();return t+"-"+(e[1]?e:"0"+e[0])+"-"+(i[1]?i:"0"+i[0])},Date.prototype.hhmm=function(){var t=this.getHours().toString(),e=this.getMinutes().toString();return(t[1]?t:"0"+t[0])+":"+(e[1]?e:"0"+e[0])},Date.prototype.hhmmss=function(){var t=this.getHours().toString(),e=this.getMinutes().toString(),i=this.getSeconds().toString();return(t[1]?t:"0"+t[0])+":"+(e[1]?e:"0"+e[0])+":"+(i[1]?i:"0"+i[0])},Date.prototype.ddmm=function(){var t=(this.getMonth()+1).toString(),e=this.getDate().toString();return(e[1]?e:"0"+e[0])+"."+(t[1]?t:"0"+t[0])+"."},Date.prototype.eeee=function(){var t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]},Date.prototype.eee=function(){var t=["Son","Mon","Die","Mit","Don","Fre","Sam"],e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]},Date.prototype.ee=function(){var t=["So","Mo","Di","Mi","Do","Fr","Sa"],e=["Su","Mo","Tu","We","Th","Fr","Sa"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]};var src=document.querySelector('script[src*="fhem-tablet-ui"]').getAttribute("src"),file=src.split("/").pop();src=src.replace("/"+file,"");var dir=src.split("/").pop();if(ftui.config.basedir=src.replace(dir,""),""===ftui.config.basedir&&(ftui.config.basedir="./"),console.log("Base dir: "+ftui.config.basedir),ftui.isValid(window.jQuery))$(document).ready(function(){onjQueryLoaded()});else{var script=document.createElement("script");script.type="text/javascript",script.onload=function(){!function(t){t(document).ready(function(){console.log("jQuery dynamically loaded"),onjQueryLoaded()})}(jQuery)},script.src=ftui.config.basedir+"lib/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(script)}